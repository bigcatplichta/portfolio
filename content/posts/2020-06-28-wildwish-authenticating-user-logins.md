---
template: SinglePost
title: 'WildWish: Authenticating User Logins'
status: Published
date: '2020-06-28'
excerpt: Using Rails to Authenticate User Logins
---
With the login form built, I need to process the input from the form with my Rails application. I'm using [Devise](https://github.com/heartcombo/devise) to handle authentication.

My form action, `loginUser()`, is using the fetch API to send a POST request to the route '/users/sign_in'. 

```
export const loginUser = (email, password) => {
    const LOGIN_URL = 'http://localhost:3001/users/sign_in'
    const LOGIN_OPTIONS = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        },
        body: JSON.stringify({ email, password })
    }

    return (dispatch) => {
        fetch(LOGIN_URL, LOGIN_OPTIONS)
        .then(response => response.json())
        .then(responseJSON => {
            dispatch({ type: 'LOGIN_USER', payload: responseJSON })
        })
    }
}
```

With my development server running, I can see this request in action when I submit my form. My console prints out:

```
Started POST "/users/sign_in" for ::1 at 2020-06-28 12:08:38 -0600
Processing by Devise::SessionsController#create as JSON
  Parameters: {"email"=>"bigcatplichta@gmail.com", "password"=>"[FILTERED]", "session"=>{"email"=>"bigcatplichta@gmail.com", "password"=>"[FILTERED]"}}
HTTP Origin header (http://localhost:3000) didn't match request.base_url (http://localhost:3001)
Completed 422 Unprocessable Entity in 1ms (ActiveRecord: 0.0ms)


ActionController::InvalidAuthenticityToken - 

ActionController::InvalidAuthenticityToken:
```

So, it went through, but I'm getting a 422 error. There are a few clues as to what's happening. It looks like I need a couple more things in my header, including an authenticity token. Rails has built in protection for Cross-Site Request Forgery.

Views generated by Rails (the page that uses ERB to build the HTML for the form) include the CSRF tokens with `<%= csrf_meta_tags %>`. Since I'm using React to build my single page app and talk to the API, I need to include this token on my own.



